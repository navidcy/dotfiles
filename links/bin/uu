#!/bin/bash
set -e
UNAMESTR=`uname`

echo "## Updating package manager lists and installed packages"
if [[ "$UNAMESTR" == 'Linux' ]]; then
    sudo apt-get update && \
        sudo apt-get upgrade && \
        sudo apt-get dist-upgrade && \
        sudo apt-get autoremove && \
        sudo apt-get clean
elif [[ "$UNAMESTR" == 'Darwin' ]]; then
    echo "Fetching updates..."
    brew analytics off
    brew update && \
        brew upgrade && \
        brew cleanup
else
    echo "Platform not supported"
    exit 1
fi

echo "## Updating dotfiles"
cd ~/code/dotfiles && \
    git pull; cd -

#echo "## Updating spacemacs"
##git pull --rebase && \
#cd ~/.emacs.d && \
#git pull && \
#git submodule sync; git submodule update

echo "## Updating pip"
for PIP in pip pip2 pip3; do
    [[ ! "$(type -P $PIP)" ]] && continue
    $PIP install --upgrade pip
    echo "## Updating $PIP packages"
    $PIP freeze --local | grep -v '^\-e' | cut -d = -f 1 | xargs $PIP install -U
done

if [[ ! "$(type -P conda)" ]]; then
    echo "## Upgrading conda packages"
    conda update --all
fi

if [[ ! "$(type -P julia)" ]]; then
    echo "## Upgrading julia packages"
    julia -e 'Pkg.update()'
fi
